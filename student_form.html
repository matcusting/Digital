<script>
  // æ£€æŸ¥æ˜¯å¦ç™»å½•
  const currentUser = JSON.parse(localStorage.getItem("loggedInUser"));
  if (!currentUser || currentUser.role !== "student") {
    alert("è¯·å…ˆç™»å½•å­¦ç”Ÿè´¦æˆ·ï¼");
    // *** å…³é”®ä¿®æ”¹ç‚¹ ***
    // ç™»å½•é¡µç°åœ¨æ˜¯ index.html
    window.location.href = "index.html"; 
  }
</script>

<button onclick="logout()" id="logoutBtnTop">ç™»å‡º</button>

<script>
  function logout() {
    localStorage.removeItem("loggedInUser");
    // *** å…³é”®ä¿®æ”¹ç‚¹ ***
    // ç™»å½•é¡µç°åœ¨æ˜¯ index.html
    window.location.href = "index.html";
  }
</script>

<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title id="title">å¿ƒæƒ…å›æŠ¥ç³»ç»Ÿ - å­¦ç”Ÿå¡«å†™é¡µ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: "Microsoft YaHei", sans-serif;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      
      /* ğŸŒŠ èˆ’ç¼“åŠ¨æ€æ¸å˜èƒŒæ™¯ */
      background: linear-gradient(-45deg, #a18cd1, #fbc2eb, #a6c1ee, #96e6a1);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .container {
      max-width: 700px;
      margin: 40px auto;
      padding: 40px;
      
      /* âœ¨ æ¯›ç»ç’ƒæ•ˆæœ */
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(15px);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
      border-bottom: 2px solid #a18cd1;
      padding-bottom: 10px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-weight: bold;
      margin-bottom: 8px;
      color: #555;
    }

    input[type="text"], select, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
      font-size: 16px;
      transition: border-color 0.3s;
    }

    input[type="text"]:focus, select:focus, textarea:focus {
        border-color: #a18cd1;
        box-shadow: 0 0 5px rgba(161, 140, 209, 0.5);
        outline: none;
    }

    textarea {
      resize: vertical;
      min-height: 150px;
    }

    button {
      display: block;
      width: 100%;
      padding: 15px;
      background: #fbc2eb;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      cursor: pointer;
      transition: background 0.3s, transform 0.1s;
      font-weight: bold;
      letter-spacing: 1px;
    }

    button:hover {
      background: #a18cd1;
      transform: translateY(-1px);
    }

    #logoutBtnTop {
        position: absolute;
        top: 20px;
        right: 20px;
        width: auto;
        padding: 10px 20px;
        background: #a6c1ee;
        z-index: 100;
    }

    #logoutBtnTop:hover {
        background: #96e6a1;
    }

    .lang-switcher {
        position: absolute;
        top: 20px;
        left: 20px;
    }

    .lang-switcher button {
        width: auto;
        padding: 8px 15px;
        margin: 0 5px;
        background-color: #eee;
        color: #333;
        font-size: 14px;
        display: inline-block;
    }

    .lang-switcher button.active {
        background-color: #a18cd1;
        color: white;
    }

    /* æˆåŠŸä¿¡æ¯å’Œå±æœºå¼¹çª—æ ·å¼ */
    #successMessage {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #27ae60;
        color: white;
        padding: 20px 40px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        display: none;
        font-size: 18px;
        font-weight: bold;
    }

    .modal {
        display: none; 
        position: fixed; 
        z-index: 2000; 
        left: 0;
        top: 0;
        width: 100%; 
        height: 100%; 
        overflow: auto; 
        background-color: rgba(0,0,0,0.6); 
        backdrop-filter: blur(5px);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 15% auto; 
        padding: 40px;
        border: 1px solid #888;
        width: 80%; 
        max-width: 500px;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    .modal-content h2 {
        color: #e74c3c;
        margin-bottom: 20px;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    .modal-content p {
        font-size: 16px;
        line-height: 1.6;
        color: #333;
        margin-bottom: 30px;
    }

    .modal-content button {
        width: 50%;
        background-color: #e74c3c;
    }
  </style>
</head>
<body>

<div class="lang-switcher">
    <button id="langZh" onclick="setLanguage('zh')">ä¸­æ–‡</button>
    <button id="langEn" onclick="setLanguage('en')">English</button>
</div>

<div class="container">
  <h1 id="headerTitle">å¿ƒæƒ…å›æŠ¥ç³»ç»Ÿ - å­¦ç”Ÿå¡«å†™é¡µ</h1>
  
  <div id="successMessage" style="display: none;">
      æäº¤æˆåŠŸï¼
  </div>

  <form id="moodReportForm">
    <div class="form-group">
      <label for="name" id="nameLabel">å§“å (ç³»ç»Ÿä¼šè‡ªåŠ¨å¡«å†™)</label>
      <input type="text" id="name" required readonly>
    </div>

    <div class="form-group">
      <label for="class" id="classLabel">ç­çº§/å­¦å· (å¯é€‰)</label>
      <input type="text" id="class" placeholder="ä¾‹å¦‚ï¼šé«˜ä¸€(1)ç­ æˆ– 2024001">
    </div>

    <div class="form-group">
      <label for="mood" id="moodLabel">æ‚¨ä»Šå¤©çš„å¿ƒæƒ…å¦‚ä½•ï¼Ÿ</label>
      <select id="mood" required>
        <option value="" disabled selected id="selectMoodPlaceholder">è¯·é€‰æ‹©</option>
        <option value="happy" id="moodHappy">ğŸ˜Š å¿«ä¹ / Happy</option>
        <option value="calm" id="moodCalm">ğŸ˜Œ å¹³é™ / Calm</option>
        <option value="bored" id="moodBored">ğŸ˜ æ— èŠ / Bored</option>
        <option value="stressed" id="moodStressed">ğŸ˜¥ å‹åŠ›å¤§ / Stressed</option>
        <option value="sad" id="moodSad">ğŸ˜” éš¾è¿‡ / Sad</option>
        <option value="angry" id="moodAngry">ğŸ˜¡ ç”Ÿæ°” / Angry</option>
        <option value="anxious" id="moodAnxious">ğŸ˜¨ ç„¦è™‘ / Anxious</option>
        <option value="hopeless" id="moodHopeless">ğŸ˜© ç»æœ› / Hopeless</option>
      </select>
    </div>

    <div class="form-group">
      <label for="problem" id="problemLabel">æ‚¨é‡åˆ°çš„ä¸»è¦é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ</label>
      <select id="problem" required>
        <option value="" disabled selected id="selectProblemPlaceholder">è¯·é€‰æ‹©</option>
        <option value="study" id="problemStudy">ğŸ“š å­¦ä¹ å‹åŠ› / Study</option>
        <option value="family" id="problemFamily">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å®¶åº­å…³ç³» / Family</option>
        <option value="relationship" id="problemRelationship">ğŸ‘¥ äººé™…å…³ç³» / Relationship</option>
        <option value="physical" id="problemPhysical">ğŸ¤’ èº«ä½“ä¸é€‚ / Physical</option>
        <option value="sleep" id="problemSleep">ğŸ˜´ ç¡çœ é—®é¢˜ / Sleep</option>
        <option value="career" id="problemCareer">ğŸ§­ æœªæ¥è§„åˆ’ / Career</option>
        <option value="other" id="problemOther">â“ å…¶ä»– / Other</option>
      </select>
    </div>

    <div class="form-group">
      <label for="message" id="messageLabel">æœ‰ä»€ä¹ˆæƒ³å‘Šè¯‰å¿ƒç†è€å¸ˆçš„è¯å—ï¼Ÿ (é€‰å¡«ï¼Œä½†é¼“åŠ±å†™ä¸‹)</label>
      <textarea id="message" placeholder="è¯·åœ¨è¿™é‡Œå†™ä¸‹ä½ çš„æƒ³æ³•ã€æ„Ÿå—æˆ–éœ€è¦å¸®åŠ©çš„å…·ä½“å†…å®¹"></textarea>
    </div>

    <button type="submit" id="submitBtn">æäº¤æŠ¥å‘Š</button>
  </form>
</div>

<div id="crisisModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2 id="modalTitle">ğŸš¨ ç´§æ€¥æé†’ï¼šä½ å¯èƒ½éœ€è¦ç«‹å³å¸®åŠ©ï¼</h2>
        <p id="modalMessage">
            æ ¹æ®ä½ å¡«å†™çš„å†…å®¹ï¼Œç³»ç»Ÿåˆ¤æ–­ä½ å¯èƒ½å¤„äº**æƒ…ç»ªå±æœº**æˆ–**æœ‰ä¼¤å®³è‡ªå·±/ä»–äººçš„é£é™©**ã€‚
            <br><br>
            **è¯·ä¸è¦ç‹¬è‡ªé¢å¯¹ï¼** è¯·ç«‹å³è”ç³»ä½ ä¿¡ä»»çš„äººæˆ–ä»¥ä¸‹ç´§æ€¥è”ç³»æ–¹å¼ï¼š
            <br>
            1. å­¦æ ¡å¿ƒç†è€å¸ˆç”µè¯ï¼š[å¡«å†™å­¦æ ¡ç”µè¯]
            <br>
            2. å…¨å›½å¿ƒç†æ´åŠ©çƒ­çº¿ï¼š400-886-0906 (24å°æ—¶)
            <br>
            3. æŠ¥è­¦ç”µè¯ï¼š110
        </p>
        <button onclick="closeModal()" id="modalCloseBtn">æˆ‘æ˜ç™½äº†ï¼Œå…³é—­</button>
    </div>
</div>

<script>
  // AI æƒ…æ„Ÿåˆ†ææ¨¡æ‹Ÿå‡½æ•°
  function analyzeSentimentAI(text) {
      if (!text) return { score: 0, isCrisis: false };
      
      let score = 0;
      let isCrisis = false;
      const negativeKeywords = ["æ­»", "ä¸æƒ³æ´»", "ä¼¤å®³", "ç»æœ›", "ç—›è‹¦", "ç»“æŸ", "æŠ‘éƒ", "å‰²è…•", "è·³æ¥¼", "è‡ªæ€"];
      const crisisTriggers = ["æ­»", "ä¸æƒ³æ´»", "ä¼¤å®³", "è‡ªæ€", "å‰²è…•", "è·³æ¥¼", "ç»“æŸç”Ÿå‘½"];

      // 1. å…³é”®è¯è¯„åˆ†
      negativeKeywords.forEach(keyword => {
          if (text.includes(keyword)) {
              score -= 3;
          }
      });
      
      crisisTriggers.forEach(keyword => {
          if (text.includes(keyword)) {
              isCrisis = true; // ç›´æ¥è§¦å‘å±æœº
          }
      });

      // 2. é•¿åº¦å’Œè¯­æ°”ï¼ˆç®€å•æ¨¡æ‹Ÿï¼‰
      if (text.length < 10) score += 1; // æ¶ˆæ¯å¤ªçŸ­å¯èƒ½ä¸æ˜¯çœŸçš„é—®é¢˜
      
      // 3. æåº¦è´Ÿé¢æƒ…ç»ªé€‰é¡¹åŠ æƒ
      const selectedMood = document.getElementById("mood").value;
      if (selectedMood === "hopeless" || selectedMood === "anxious") score -= 3;
      if (selectedMood === "sad" || selectedMood === "angry" || selectedMood === "stressed") score -= 1;
      
      // 4. å±æœºåˆ†æ•°åˆ¤æ–­
      if (score <= -5) {
          isCrisis = true;
      }
      
      return { score, isCrisis };
  }
  
  const langText = {
      zh: {
          title: "å¿ƒæƒ…å›æŠ¥ç³»ç»Ÿ - å­¦ç”Ÿå¡«å†™é¡µ",
          headerTitle: "å¿ƒæƒ…å›æŠ¥ç³»ç»Ÿ - å­¦ç”Ÿå¡«å†™é¡µ",
          nameLabel: "å§“å (ç³»ç»Ÿä¼šè‡ªåŠ¨å¡«å†™)",
          classLabel: "ç­çº§/å­¦å· (å¯é€‰)",
          moodLabel: "æ‚¨ä»Šå¤©çš„å¿ƒæƒ…å¦‚ä½•ï¼Ÿ",
          problemLabel: "æ‚¨é‡åˆ°çš„ä¸»è¦é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ",
          messageLabel: "æœ‰ä»€ä¹ˆæƒ³å‘Šè¯‰å¿ƒç†è€å¸ˆçš„è¯å—ï¼Ÿ (é€‰å¡«ï¼Œä½†é¼“åŠ±å†™ä¸‹)",
          submitBtn: "æäº¤æŠ¥å‘Š",
          placeholderClass: "ä¾‹å¦‚ï¼šé«˜ä¸€(1)ç­ æˆ– 2024001",
          placeholderMessage: "è¯·åœ¨è¿™é‡Œå†™ä¸‹ä½ çš„æƒ³æ³•ã€æ„Ÿå—æˆ–éœ€è¦å¸®åŠ©çš„å…·ä½“å†…å®¹",
          selectMoodPlaceholder: "è¯·é€‰æ‹©",
          moodHappy: "ğŸ˜Š å¿«ä¹", moodCalm: "ğŸ˜Œ å¹³é™", moodBored: "ğŸ˜ æ— èŠ", moodStressed: "ğŸ˜¥ å‹åŠ›å¤§", moodSad: "ğŸ˜” éš¾è¿‡", moodAngry: "ğŸ˜¡ ç”Ÿæ°”", moodAnxious: "ğŸ˜¨ ç„¦è™‘", moodHopeless: "ğŸ˜© ç»æœ›",
          selectProblemPlaceholder: "è¯·é€‰æ‹©",
          problemStudy: "ğŸ“š å­¦ä¹ å‹åŠ›", problemFamily: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å®¶åº­å…³ç³»", problemRelationship: "ğŸ‘¥ äººé™…å…³ç³»", problemPhysical: "ğŸ¤’ èº«ä½“ä¸é€‚", problemSleep: "ğŸ˜´ ç¡çœ é—®é¢˜", problemCareer: "ğŸ§­ æœªæ¥è§„åˆ’", problemOther: "â“ å…¶ä»–",
          successMessage: "æäº¤æˆåŠŸï¼",
          modalTitle: "ğŸš¨ ç´§æ€¥æé†’ï¼šä½ å¯èƒ½éœ€è¦ç«‹å³å¸®åŠ©ï¼",
          modalMessage: `æ ¹æ®ä½ å¡«å†™çš„å†…å®¹ï¼Œç³»ç»Ÿåˆ¤æ–­ä½ å¯èƒ½å¤„äº**æƒ…ç»ªå±æœº**æˆ–**æœ‰ä¼¤å®³è‡ªå·±/ä»–äººçš„é£é™©**ã€‚
            <br><br>
            **è¯·ä¸è¦ç‹¬è‡ªé¢å¯¹ï¼** è¯·ç«‹å³è”ç³»ä½ ä¿¡ä»»çš„äººæˆ–ä»¥ä¸‹ç´§æ€¥è”ç³»æ–¹å¼ï¼š
            <br>
            1. å­¦æ ¡å¿ƒç†è€å¸ˆç”µè¯ï¼š[å¡«å†™å­¦æ ¡ç”µè¯]
            <br>
            2. å…¨å›½å¿ƒç†æ´åŠ©çƒ­çº¿ï¼š400-886-0906 (24å°æ—¶)
            <br>
            3. æŠ¥è­¦ç”µè¯ï¼š110`,
          modalCloseBtn: "æˆ‘æ˜ç™½äº†ï¼Œå…³é—­",
          logout: "ç™»å‡º"
      },
      en: {
          title: "Mood Report System - Student Form",
          headerTitle: "Mood Report System - Student Form",
          nameLabel: "Name (Auto-filled)",
          classLabel: "Class/ID (Optional)",
          moodLabel: "How are you feeling today?",
          problemLabel: "What is the main problem you are facing?",
          messageLabel: "Is there anything you want to tell the counselor? (Optional, but encouraged)",
          submitBtn: "Submit Report",
          placeholderClass: "e.g., Grade 10-1 or 2024001",
          placeholderMessage: "Write down your thoughts, feelings, or specific needs for help here.",
          selectMoodPlaceholder: "Select",
          moodHappy: "ğŸ˜Š Happy", moodCalm: "ğŸ˜Œ Calm", moodBored: "ğŸ˜ Bored", moodStressed: "ğŸ˜¥ Stressed", moodSad: "ğŸ˜” Sad", moodAngry: "ğŸ˜¡ Angry", moodAnxious: "ğŸ˜¨ Anxious", moodHopeless: "ğŸ˜© Hopeless",
          selectProblemPlaceholder: "Select",
          problemStudy: "ğŸ“š Study Pressure", problemFamily: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family", problemRelationship: "ğŸ‘¥ Relationship", problemPhysical: "ğŸ¤’ Physical", problemSleep: "ğŸ˜´ Sleep Issues", problemCareer: "ğŸ§­ Career", problemOther: "â“ Other",
          successMessage: "Submitted Successfully!",
          modalTitle: "ğŸš¨ EMERGENCY ALERT: You may need immediate help!",
          modalMessage: `Based on your input, the system suggests you may be in an **emotional crisis** or **at risk of harming yourself/others**.
            <br><br>
            **Please do not face this alone!** Contact a trusted person or one of the following emergency contacts immediately:
            <br>
            1. School Counselor Phone: [Fill in School Phone]
            <br>
            2. National Crisis Hotline: 400-886-0906 (24/7)
            <br>
            3. Emergency Services: 110 (Police) / 999 (Emergency)`,
          modalCloseBtn: "I Understand, Close",
          logout: "Logout"
      }
  };
  
  // è¾…åŠ©å‡½æ•°ï¼šæ ¹æ®å€¼è·å–å¯¹åº”çš„ä¸­æ–‡Key
  function getChineseKey(value) {
      for (const key in langText.zh) {
          if (langText.zh[key].toLowerCase().includes(value.toLowerCase())) {
              return key;
          }
      }
      return value;
  }

  // è¾…åŠ©å‡½æ•°ï¼šæ ‡å‡†åŒ–å€¼ (ç”¨äºå­˜å‚¨)
  function getStandardValue(value, type) {
      if (!value) return '';
      // éå†ä¸­æ–‡å’Œè‹±æ–‡ï¼Œæ‰¾åˆ°å¯¹åº”çš„æ ‡å‡†å€¼ï¼ˆå¦‚ happy, studyï¼‰
      for (const key in langText.zh) {
          if (type === 'mood' && key.startsWith('mood') && langText.zh[key].includes(value)) {
              return key.substring(4).toLowerCase(); // æå– happy/calm ç­‰
          }
          if (type === 'problem' && key.startsWith('problem') && langText.zh[key].includes(value)) {
              return key.substring(7).toLowerCase(); // æå– study/family ç­‰
          }
      }
      return value; // å¦åˆ™è¿”å›åŸå§‹å€¼
  }

  function setLanguage(lang) {
    localStorage.setItem("lang", lang);
    const t = langText[lang];

    // æ›´æ–°æŒ‰é’®çŠ¶æ€
    document.getElementById("langZh").classList.toggle("active", lang === "zh");
    document.getElementById("langEn").classList.toggle("active", lang === "en");

    document.getElementById("title").innerText = t.title;
    document.getElementById("headerTitle").innerText = t.headerTitle;
    document.getElementById("nameLabel").innerText = t.nameLabel;
    document.getElementById("classLabel").innerText = t.classLabel;
    document.getElementById("moodLabel").innerText = t.moodLabel;
    document.getElementById("problemLabel").innerText = t.problemLabel;
    document.getElementById("messageLabel").innerText = t.messageLabel;
    document.getElementById("submitBtn").innerText = t.submitBtn;
    document.getElementById("class").placeholder = t.placeholderClass;
    document.getElementById("message").placeholder = t.placeholderMessage;
    document.getElementById("logoutBtnTop").innerText = t.logout;
    document.getElementById("successMessage").innerText = t.successMessage;
    
    // æ›´æ–°é€‰é¡¹
    document.getElementById("selectMoodPlaceholder").innerText = t.selectMoodPlaceholder;
    document.getElementById("moodHappy").innerText = t.moodHappy;
    document.getElementById("moodCalm").innerText = t.moodCalm;
    document.getElementById("moodBored").innerText = t.moodBored;
    document.getElementById("moodStressed").innerText = t.moodStressed;
    document.getElementById("moodSad").innerText = t.moodSad;
    document.getElementById("moodAngry").innerText = t.moodAngry;
    document.getElementById("moodAnxious").innerText = t.moodAnxious;
    document.getElementById("moodHopeless").innerText = t.moodHopeless;
    
    document.getElementById("selectProblemPlaceholder").innerText = t.selectProblemPlaceholder;
    document.getElementById("problemStudy").innerText = t.problemStudy;
    document.getElementById("problemFamily").innerText = t.problemFamily;
    document.getElementById("problemRelationship").innerText = t.problemRelationship;
    document.getElementById("problemPhysical").innerText = t.problemPhysical;
    document.getElementById("problemSleep").innerText = t.problemSleep;
    document.getElementById("problemCareer").innerText = t.problemCareer;
    document.getElementById("problemOther").innerText = t.problemOther;

    // æ›´æ–°å¼¹çª—
    document.getElementById("modalTitle").innerHTML = t.modalTitle;
    document.getElementById("modalMessage").innerHTML = t.modalMessage;
    document.getElementById("modalCloseBtn").innerText = t.modalCloseBtn;
  }
  
  const form = document.getElementById("moodReportForm");
  
  // è‡ªåŠ¨å¡«å……ç”¨æˆ·å
  const nameInput = document.getElementById("name");
  if (currentUser) {
      nameInput.value = currentUser.username;
  }
  
  form.addEventListener("submit", function(e) {
      e.preventDefault();
      
      const currentLang = localStorage.getItem("lang") || "zh";
      const moodValue = document.getElementById("mood").value;
      const problemValue = document.getElementById("problem").value;
      const messageValue = document.getElementById("message").value;

      // æƒ…æ„Ÿåˆ†æ
      const analysis = analyzeSentimentAI(messageValue);

      const record = {
        name: document.getElementById("name").value,
        class: document.getElementById("class").value.trim() || 'æœªå¡«å†™', 
        mood: getStandardValue(moodValue, 'mood'),
        problem: getStandardValue(problemValue, 'problem'),
        message: messageValue,
        date: new Date().toLocaleDateString(),
        sentimentScore: analysis.score,
        isCrisis: analysis.isCrisis
      };

      if (analysis.isCrisis) {
          document.getElementById("crisisModal").style.display = "block";
      } else {
          document.getElementById("successMessage").style.display = "block";
          setTimeout(() => { document.getElementById("successMessage").style.display = "none"; }, 3000);
      }

      let allData = JSON.parse(localStorage.getItem("moodReports") || "[]");
      allData.push(record);
      localStorage.setItem("moodReports", JSON.stringify(allData));

      e.target.reset();
      setLanguage(currentLang);
    });

    function closeModal() {
        document.getElementById("crisisModal").style.display = "none";
    }

    const savedLang = localStorage.getItem("lang") || "zh";
    setLanguage(savedLang);

</script>

</body>
</html>
