<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title id="title">å¿ƒç†è¾…å¯¼ç³»ç»Ÿ - æ³¨å†Œ</title>
  <style>
    body {
      font-family: "Microsoft YaHei", sans-serif;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      
      /* ğŸŒŠ åŠ¨æ€æ¸å˜èƒŒæ™¯ */
      background: linear-gradient(-45deg, #a18cd1, #fbc2eb, #a6c1ee, #96e6a1);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .register-box {
      width: 320px;
      text-align: center;
      padding: 40px;
      
      /* âœ¨ æ¯›ç»ç’ƒæ•ˆæœ */
      background: rgba(255, 255, 255, 0.75);
      backdrop-filter: blur(12px);
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      transition: all 0.3s ease;
    }

    .register-box:hover {
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        transform: translateY(-2px);
    }

    h1 {
      margin-bottom: 30px;
      color: #333;
      font-size: 24px;
      border-bottom: 2px solid #a18cd1;
      padding-bottom: 10px;
    }

    .input-group {
      margin-bottom: 20px;
      text-align: left;
    }

    .input-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #555;
    }

    input[type="text"], input[type="password"], select {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
      font-size: 16px;
      transition: border-color 0.3s;
    }

    input[type="text"]:focus, input[type="password"]:focus, select:focus {
        border-color: #a18cd1;
        box-shadow: 0 0 5px rgba(161, 140, 209, 0.5);
        outline: none;
    }

    button {
      width: 100%;
      padding: 15px;
      background: #fbc2eb;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      cursor: pointer;
      transition: background 0.3s, transform 0.1s;
      font-weight: bold;
      letter-spacing: 1px;
    }

    button:hover {
      background: #a18cd1;
      transform: translateY(-1px);
    }

    .message-msg {
      color: #e74c3c;
      margin-top: 15px;
      min-height: 20px;
    }

    .footer-links {
      margin-top: 25px;
      font-size: 14px;
    }

    .footer-links a {
      color: #a18cd1;
      text-decoration: none;
      font-weight: bold;
    }

    .footer-links a:hover {
        text-decoration: underline;
    }

    .lang-switcher {
        margin-bottom: 20px;
    }

    .lang-switcher button {
        width: auto;
        padding: 8px 15px;
        margin: 0 5px;
        background-color: #eee;
        color: #333;
        font-size: 14px;
    }

    .lang-switcher button.active {
        background-color: #a18cd1;
        color: white;
    }
  </style>
</head>
<body>

<div class="register-box">
    <div class="lang-switcher">
        <button id="langZh" onclick="setLanguage('zh')">ä¸­æ–‡</button>
        <button id="langEn" onclick="setLanguage('en')">English</button>
    </div>
    <h1 id="title">å¿ƒç†è¾…å¯¼ç³»ç»Ÿ - æ³¨å†Œ</h1>
    
    <div class="input-group">
        <label for="role" id="roleLabel">èº«ä»½</label>
        <select id="role" onchange="toggleTeacherKey()">
            <option value="student" id="roleStudent">å­¦ç”Ÿ</option>
            <option value="teacher" id="roleTeacher">è€å¸ˆ</option>
        </select>
    </div>

    <div class="input-group" id="teacherKeyGroup" style="display: none;">
        <label for="teacherKey" id="teacherKeyLabel">è€å¸ˆæ³¨å†Œç </label>
        <input type="password" id="teacherKey" placeholder="è¯·è¾“å…¥è€å¸ˆæ³¨å†Œç ">
    </div>

    <div class="input-group">
        <label for="username" id="usernameLabel">ç”¨æˆ·å</label>
        <input type="text" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
    </div>

    <div class="input-group">
        <label for="password" id="passwordLabel">å¯†ç </label>
        <input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç ">
    </div>
    
    <div class="input-group">
        <label for="confirm" id="confirmLabel">ç¡®è®¤å¯†ç </label>
        <input type="password" id="confirm" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
    </div>
    
    <button onclick="register()" id="registerBtn">æ³¨å†Œ</button>
    
    <p class="message-msg" id="msg"></p>

    <div class="footer-links" id="loginLink">
        <span id="haveAccountText">å·²æœ‰è´¦æˆ·ï¼Ÿ</span> <a href="index.html" id="loginText">ç«‹å³ç™»å½•</a>
    </div>

</div>

<script>
    const TEACHER_KEY = "counselor2024"; // ç®€å•çš„è€å¸ˆæ³¨å†Œç 

    const langText = {
        zh: {
            title: "å¿ƒç†è¾…å¯¼ç³»ç»Ÿ - æ³¨å†Œ",
            roleLabel: "èº«ä»½",
            roleStudent: "å­¦ç”Ÿ",
            roleTeacher: "è€å¸ˆ",
            usernameLabel: "ç”¨æˆ·å",
            passwordLabel: "å¯†ç ",
            confirmLabel: "ç¡®è®¤å¯†ç ",
            username: "è¯·è¾“å…¥ç”¨æˆ·å",
            password: "è¯·è¾“å…¥å¯†ç ",
            confirm: "è¯·å†æ¬¡è¾“å…¥å¯†ç ",
            register: "æ³¨å†Œ",
            haveAccount: "å·²æœ‰è´¦æˆ·ï¼Ÿ",
            login: "ç«‹å³ç™»å½•",
            teacher_key_label: "è€å¸ˆæ³¨å†Œç ",
            teacher_key_placeholder: "è¯·è¾“å…¥è€å¸ˆæ³¨å†Œç ",
            empty: "ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©º",
            mismatch: "ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´",
            exists: "ç”¨æˆ·åå·²å­˜åœ¨",
            success: "æ³¨å†ŒæˆåŠŸï¼æ­£åœ¨è·³è½¬åˆ°ç™»å½•é¡µ...",
            teacher_key_invalid: "è€å¸ˆæ³¨å†Œç é”™è¯¯"
        },
        en: {
            title: "Mental Health System - Register",
            roleLabel: "Role",
            roleStudent: "Student",
            roleTeacher: "Teacher",
            usernameLabel: "Username",
            passwordLabel: "Password",
            confirmLabel: "Confirm Password",
            username: "Enter Username",
            password: "Enter Password",
            confirm: "Enter Password Again",
            register: "Register",
            haveAccount: "Already have an account?",
            login: "Login Now",
            teacher_key_label: "Teacher Key",
            teacher_key_placeholder: "Enter Teacher Key",
            empty: "Username and password cannot be empty",
            mismatch: "Passwords do not match",
            exists: "Username already exists",
            success: "Registration successful! Redirecting to login page...",
            teacher_key_invalid: "Invalid Teacher Key"
        }
    };

    function toggleTeacherKey() {
        const role = document.getElementById("role").value;
        document.getElementById("teacherKeyGroup").style.display = (role === 'teacher' ? 'block' : 'none');
    }

    function setLanguage(lang) {
        localStorage.setItem("lang", lang);
        const t = langText[lang];

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        document.getElementById("langZh").classList.toggle("active", lang === "zh");
        document.getElementById("langEn").classList.toggle("active", lang === "en");

        document.getElementById("title").innerText = t.title;
        document.getElementById("roleLabel").innerText = t.roleLabel;
        document.getElementById("roleStudent").innerText = t.roleStudent;
        document.getElementById("roleTeacher").innerText = t.roleTeacher;
        document.getElementById("usernameLabel").innerText = t.usernameLabel;
        document.getElementById("passwordLabel").innerText = t.passwordLabel;
        document.getElementById("confirmLabel").innerText = t.confirmLabel;
        document.getElementById("username").placeholder = t.username;
        document.getElementById("password").placeholder = t.password;
        document.getElementById("confirm").placeholder = t.confirm;
        document.getElementById("registerBtn").innerText = t.register;
        document.getElementById("haveAccountText").innerText = t.haveAccount;
        // *** å…³é”®ä¿®æ”¹ç‚¹ ***
        // é“¾æ¥åˆ°æ–°çš„ç™»å½•é¡µ index.html
        document.getElementById("loginLink").innerHTML = `${t.haveAccount} <a href="index.html" id="loginText">${t.login}</a>`; 
        document.getElementById("teacherKeyLabel").innerText = t.teacher_key_label;
        document.getElementById("teacherKey").placeholder = t.teacher_key_placeholder;
    }

    function register() {
      const lang = localStorage.getItem("lang") || "zh";
      const t = langText[lang];
      const role = document.getElementById("role").value;
      const user = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value.trim();
      const confirm = document.getElementById("confirm").value.trim();
      const msg = document.getElementById("msg");

      if (!user || !pass) { msg.innerText = t.empty; return; }
      if (pass !== confirm) { msg.innerText = t.mismatch; return; }

      if (role === 'teacher') {
          const teacherKeyInput = document.getElementById("teacherKey").value.trim();
          if (teacherKeyInput !== TEACHER_KEY) {
              msg.innerText = t.teacher_key_invalid; return;
          }
      }

      let users = JSON.parse(localStorage.getItem("users") || "[]");
      if (users.some(u => u.username === user)) { msg.innerText = t.exists; return; }

      const obfuscatedPassword = btoa(pass); 
      users.push({ username: user, password: obfuscatedPassword, role });
      localStorage.setItem("users", JSON.stringify(users));

      msg.style.color = "#27ae60";
      msg.innerText = t.success;
      // *** å…³é”®ä¿®æ”¹ç‚¹ ***
      // æ³¨å†ŒæˆåŠŸåï¼Œè·³è½¬åˆ°æ–°çš„ç™»å½•é¡µ index.html
      setTimeout(() => window.location.href = "index.html", 1500);
    }

    const currentLang = localStorage.getItem("lang") || "zh";
    setLanguage(currentLang);
</script>

</body>
</html>
